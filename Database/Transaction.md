## Transaction이란?

 트랜잭션은 작업의 **완전성**을 보장해주는 것이다. 즉, 논리적인 작업 Set을 모두 완벽하게 처리하거나 또는 처리하지 못 할 경우 원 상태로
 복구해서 작업의 일부만 적용되는 현상이 발생하지 않게 만들어주는 기능이다.
 
 사용자의 입장에서는 작업의 논리적 단위로 이해할 수 있고, 시스템 입장에서는 데이터들을 접근 또는 변경하는 프로그램의 단위가 된다.
 

### 트랜잭션 & Lock

 Lock과 트랜잭션은 서로 비슷한 개념 같지만 사실 Lock은 동시성 제어를 위한 기능이고, 트랜잭션은 데이터의 정합성을 보장하기 위한 기능이다.
 
 Lock은 여러 커넥션에서 동시에 동일한 자원을 요청할 경우 순서대로 한 시점에는 하나의 커넥션만 변경할 수 있게 해주는 역하을 한다.
 여기서 자원은 레코드나 테이블을 말한다.
 
 이와는 조금 다르게 트랜잭션은 꼭 여러 개의 변경 작업을 수행하는 쿼리가 조합되었을 때만 의미있는 개념은 아니다. 트랜잭션은 하나의 논리적인
 작업 Set 중 하나의 쿼리가 있든 두 개 이상의 쿼리가 있든 관계없이 논리적인 작업 Set 자체가 100% 적용되거나 아무것도 적용되지 않아야 함을 보장하는 것이다.
 
 예를 들면 HW 에러 또는 SW 에러와 같은 문제로 인해 작업 실패가 발생할 경우 특별한 대책이 필요하게 되는데, 이러한 문제를 해결하는 것이다.
 
 - 현금 인출기 작동 도중 기계 오류나 정전 등과 같은 예기치 않은 상황이 발생하여 카드가 나오지 않거나 기계가 멈추는 경우
 
 - 각각 다른 지점의 은행에서 동시에 인출할 때, 하나의 지점이 다른 지점에서 저장한 잔액을 덮어 쓰는 경우

### 트랜잭션의 특성 (ACID)

 #### 원자성 (Atomicity)
 
 만약 트랜잭션 중간에 어떠한 문제가 발생한다면 트랜잭션에 해당하는 어떠한 작업 내용도 수행되어서는 안되며, 아무런 문제가 발생되지
 않았을 경우에만 모든 작업이 수행되어야 한다. (All or Nothing)
 
 #### 일관성 (Consistency)
 
 트랜잭션이 완료된 이 후 상태에서도 트랜잭션이 일어나기 전 상황과 동일하게 데이터의 일관성을 보장해야 한다.
 
 #### 고립성 (Isolation)
 
 각각의 트랜잭션은 서로 간섭없이 독립적으로 수행되어야 한다.
 
 #### 지속성 (Durability)
 
 트랜잭션이 정상적으로 종료된 다음에는 영구적으로 DB에 작업의 결과가 저장되어야 한다.

### 트랜잭션 사용시 주의점

 트랜잭션은 꼭 필요한 최소의 코드에만 적용하는 것이 좋다. 즉, 트랜잭션의 범위를 최소화하라는 의미다. 일반적으로 DB 커넥션의 개수는 제한적이다.
 그런데 각 단위 프로그램이 커넥션을 소유하는 시간이 길어지면 사용 가능한 여유 커넥션 개수가 줄어든다. 그러다 어느 순간에는 각 단위 프로그램에서
 커넥션을 가져가기 위해 기다려야 하는 상황이 발생할 수 있는 것이다.
 
 
## 트랜잭션 상태

#### 활동 (Active)
 
 트랜잭션이 실행 중에 있는 상태, 연산들이 정상적으로 실행 중인 상태
  
#### 장애 (Failed)
 
 트랜잭션이 실행에 오류가 발생하여 중단된 상태
  
#### 철회 (Aborted)
  
 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
  
#### 부분 완료 (Partially Committed)
 
 트랜잭션이 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
  
#### 완료 (Committed)
 
 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태
  
### Commit 

 하나의 트랜잭션이 성공적으로 끝났고, DB가 일관성이 있는 상태일 때 이를 알려주기 위해 사용하는 연산
 
### Rollback

 하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션 원자성이 깨진 경우
 
 Transaction이 정상적으로 종료되지 않았을 때, Last Consistent state (ex, Transaction의 시작 상태)로 Roll back할 수 있음
 
  
